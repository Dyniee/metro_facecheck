{% extends "base.html" %}

{% block extra_css %}<link rel="stylesheet" href="{{ url_for('static', filename='css/history.css') }}">{% endblock %}

{% block title %}L·ªãch S·ª≠ V√© - Metro FaceCheck{% endblock %}


{% block content %}
<div class="page-container">
    <div class="page-header">
        <h2>L·ªãch S·ª≠ V√© C·ªßa B·∫°n</h2>
        <p>Xem t·∫•t c·∫£ c√°c v√© ƒë√£ mua</p>
    </div>


    {% if tickets %}
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ID V√©</th>
                        <th>Lo·∫°i V√©</th>
                        <th>Chi Ti·∫øt (T·ª´ ‚Üí ƒê·∫øn)</th>
                        <th>Gi√° V√©</th>
                        <th>Hi·ªáu L·ª±c (Ng√†y/Gi·ªù)</th> <th>Tr·∫°ng Th√°i</th>
                        <th>Ng√†y Mua</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ticket in tickets %}
                        <tr>
                            <td>{{ ticket.id }}</td>
                            <td>
                                {% if ticket.ticket_type == 'monthly' %}
                                    <span class="badge badge-primary">V√© Th√°ng</span>
                                {% else %}
                                    <span class="badge badge-secondary">V√© L∆∞·ª£t</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if ticket.ticket_type == 'single' %}
                                    {{ ticket.from_station_name or '-' }} ‚Üí {{ ticket.to_station_name or '-' }}
                                {% else %}
                                    (T·∫•t c·∫£ c√°c tuy·∫øn)
                                {% endif %}
                            </td>
                            <td class="ticket-price">
                                {{ "{:,.0f} VNƒê".format(ticket.purchase_price) if ticket.purchase_price is not none else 'N/A' }}
                            </td>
                            
                            <td>
                                {% if ticket.ticket_type == 'monthly' %}
                                    30 ng√†y (t·ª´ {{ ticket.valid_from.strftime('%d/%m/%Y') if ticket.valid_from else '-' }})
                                {% else %}
                                    <strong>{{ ticket.expected_departure_time.strftime('%H:%M') if ticket.expected_departure_time else 'N/A' }}</strong>
                                    <br>
                                    <span style="font-size: 0.9em; color: #666;">
                                        {{ ticket.valid_from.strftime('%d/%m/%Y') if ticket.valid_from else '-' }}
                                    </span>
                                {% endif %}
                            </td>
                            
                            <td>
                                {% if ticket.status == 'NEW' and ticket.used == 0 %}
                                    <span class="badge badge-primary">M·ªõi</span>
                                {% elif ticket.status == 'USED' or ticket.used == 1 %}
                                    <span class="badge badge-success">ƒê√£ D√πng</span>
                                {% else %}
                                    <span class="badge badge-warning">{{ ticket.status or 'H·∫øt h·∫°n' }}</span>
                                {% endif %}
                            </td>
                            <td>{{ ticket.purchase_time.strftime('%d/%m/%Y %H:%M') if ticket.purchase_time else '-' }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">üìù</div>
            <h3>Ch∆∞a C√≥ V√© N√†o</h3>
            <p>H√£y mua v√© ƒë·∫ßu ti√™n c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu s·ª≠ d·ª•ng d·ªãch v·ª•.</p>
            <a href="/buy_ticket" class="btn btn-primary btn-lg">Mua V√© Ngay</a>
        </div>
    {% endif %}
</div>
{% endblock %}